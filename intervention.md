  ---                                                                                                                                                                                                                
  LEAGUE OF CHAMPIONS - A/B/C INTERVENTION FRAMEWORK ANALYSIS                                                                                                                                                        
                                                                                                                                                                                                                     
  EXECUTIVE SUMMARY                                                                                                                                                                                                  
                                                                                                                                                                                                                     
  After scanning the codebase, I've identified that the A/B/C Student Intervention Framework does not currently exist. The existing "interventions" in the codebase are for staff monitoring/coaching (system        
  health), not student behavioral interventions.                                                                                                                                                                     
                                                                                                                                                                                                                     
  Critical Finding: The system needs a complete new module for student behavioral interventions. The good news is the existing architecture provides solid patterns to build upon.                                   
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  1. COMPREHENSIVE FEATURE MAPPING                                                                                                                                                                                   
                                                                                                                                                                                                                     
  Current Features âœ… (Reusable)                                                                                                                                                                                     
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                                
  â”‚          Feature           â”‚           Location           â”‚      Reuse for A/B/C Framework      â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Student Records            â”‚ students table               â”‚ Student identity for interventions  â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Staff Records              â”‚ staff table                  â”‚ Intervention assignees              â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ RBAC System                â”‚ roles, permissions, profiles â”‚ Case Manager, Teacher roles         â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Merit Logging              â”‚ merit_log table              â”‚ Pattern for intervention logging    â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Behavior Pattern Detection â”‚ behaviourAnalyzer.ts         â”‚ Escalation trigger detection        â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Alert Thresholds           â”‚ alert_thresholds table       â”‚ Pattern for intervention thresholds â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Email Templates            â”‚ email_templates, email_queue â”‚ Notification system                 â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ House System               â”‚ House fields across tables   â”‚ Location context                    â”‚                                                                                                                
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                
  â”‚ Analytics Snapshots        â”‚ analytics_snapshots          â”‚ Pattern for intervention analytics  â”‚                                                                                                                
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                                
  Missing Features âŒ (Must Build)                                                                                                                                                                                   
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                                                                      
  â”‚       Required Feature       â”‚ Current Status  â”‚ Priority â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Four Behavioral Domains      â”‚ Not implemented â”‚ P0       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Level A Interventions        â”‚ Not implemented â”‚ P0       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Level B Interventions        â”‚ Not implemented â”‚ P0       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Level C Case Management      â”‚ Not implemented â”‚ P0       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Re-entry Protocols           â”‚ Not implemented â”‚ P1       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Domain-Specific Repair Menus â”‚ Not implemented â”‚ P1       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Decision Tree Logic          â”‚ Not implemented â”‚ P1       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Student Support Plans        â”‚ Not implemented â”‚ P1       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Monitoring Workflows         â”‚ Not implemented â”‚ P2       â”‚                                                                                                                                                      
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                                      
  â”‚ Calibration System           â”‚ Not implemented â”‚ P2       â”‚                                                                                                                                                      
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                                                                      
  Partial Features ğŸŸ¡ (Enhancement Needed)                                                                                                                                                                           
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                            
  â”‚        Feature         â”‚             Current State              â”‚        Enhancement Needed         â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ Behavior Insights      â”‚ Computes risk_level (green/yellow/red) â”‚ Link to A/B/C escalation triggers â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ Pattern Detection      â”‚ Detects early_concern, escalation      â”‚ Connect to Level B triggers       â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ Staff Permissions      â”‚ Admin/Staff/Parent                     â”‚ Add Case Manager role             â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ Intervention Playbooks â”‚ Exists (for staff)                     â”‚ Create student-focused playbooks  â”‚                                                                                                            
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                            
  ---                                                                                                                                                                                                                
  2. DATABASE SCHEMA RECOMMENDATIONS                                                                                                                                                                                 
                                                                                                                                                                                                                     
âº New Tables Required (Migration 012)                                                                                                                                                                                
                                                                                                                                                                                                                     
  -- ============================================================================                                                                                                                                    
  -- MIGRATION 012: A/B/C STUDENT INTERVENTION FRAMEWORK                                                                                                                                                             
  -- ============================================================================                                                                                                                                    
                                                                                                                                                                                                                     
  -- 1. BEHAVIORAL DOMAINS (Reference Table)                                                                                                                                                                         
  CREATE TABLE behavioral_domains (                                                                                                                                                                                  
    id SERIAL PRIMARY KEY,                                                                                                                                                                                           
    domain_key TEXT NOT NULL UNIQUE,      -- 'prayer_space', 'hallways', 'lunch_recess', 'respect'                                                                                                                   
    domain_name TEXT NOT NULL,            -- Display name                                                                                                                                                            
    description TEXT,                                                                                                                                                                                                
    expectations JSONB,                   -- Domain-specific behavioral expectations                                                                                                                                 
    repair_menu_immediate JSONB,          -- Immediate repair options                                                                                                                                                
    repair_menu_restorative JSONB,        -- Restorative repair options                                                                                                                                              
    is_active BOOLEAN DEFAULT TRUE,                                                                                                                                                                                  
    created_at TIMESTAMPTZ DEFAULT NOW()                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- 2. LEVEL A INTERVENTIONS (In-the-moment coaching, 30-90 sec)                                                                                                                                                    
  CREATE TABLE level_a_interventions (                                                                                                                                                                               
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                                   
    student_id UUID NOT NULL REFERENCES students(id),                                                                                                                                                                
    staff_id UUID REFERENCES auth.users(id),                                                                                                                                                                         
    staff_name TEXT NOT NULL,                                                                                                                                                                                        
                                                                                                                                                                                                                     
    -- Intervention Details                                                                                                                                                                                          
    domain_id INTEGER REFERENCES behavioral_domains(id),                                                                                                                                                             
    intervention_type TEXT NOT NULL,       -- 'pre_correct', 'positive_narration', 'quick_redirect',                                                                                                                 
                                           -- 'redo', 'choice_consequence', 'private_check',                                                                                                                         
                                           -- 'micro_repair', 'quick_reinforcement'                                                                                                                                  
    behavior_description TEXT,                                                                                                                                                                                       
    location TEXT,                                                                                                                                                                                                   
                                                                                                                                                                                                                     
    -- Outcome                                                                                                                                                                                                       
    outcome TEXT NOT NULL DEFAULT 'complied',  -- 'complied', 'escalated', 'partial'                                                                                                                                 
    escalated_to_b BOOLEAN DEFAULT FALSE,                                                                                                                                                                            
                                                                                                                                                                                                                     
    -- Context (for pattern detection)                                                                                                                                                                               
    is_repeated_same_day BOOLEAN DEFAULT FALSE,                                                                                                                                                                      
    affected_others BOOLEAN DEFAULT FALSE,                                                                                                                                                                           
    is_pattern_student BOOLEAN DEFAULT FALSE,                                                                                                                                                                        
                                                                                                                                                                                                                     
    -- Metadata                                                                                                                                                                                                      
    event_timestamp TIMESTAMPTZ DEFAULT NOW(),                                                                                                                                                                       
    created_at TIMESTAMPTZ DEFAULT NOW()                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- 3. LEVEL B INTERVENTIONS (Structured reset conference, 15-20 min)                                                                                                                                               
  CREATE TABLE level_b_interventions (                                                                                                                                                                               
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                                   
    student_id UUID NOT NULL REFERENCES students(id),                                                                                                                                                                
    staff_id UUID REFERENCES auth.users(id),                                                                                                                                                                         
    staff_name TEXT NOT NULL,                                                                                                                                                                                        
                                                                                                                                                                                                                     
    -- Intervention Details                                                                                                                                                                                          
    domain_id INTEGER REFERENCES behavioral_domains(id),                                                                                                                                                             
    escalation_trigger TEXT NOT NULL,      -- 'demerit_assigned', '3rd_incident_10days',                                                                                                                             
                                           -- 'ignored_2plus_prompts', 'peer_impact',                                                                                                                                
                                           -- 'space_disruption', 'safety_risk'                                                                                                                                      
                                                                                                                                                                                                                     
    -- 7-Step Protocol Tracking                                                                                                                                                                                      
    b1_regulate_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                                     
    b1_regulate_notes TEXT,                                                                                                                                                                                          
    b2_pattern_naming_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                               
    b2_pattern_notes TEXT,                                                                                                                                                                                           
    b3_reflection_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                                   
    b3_reflection_prompts_used JSONB,      -- Array of prompts used                                                                                                                                                  
    b4_repair_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                                       
    b4_repair_action_selected TEXT,        -- From domain repair menu                                                                                                                                                
    b5_replacement_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                                  
    b5_replacement_skill_practiced TEXT,                                                                                                                                                                             
    b6_reset_goal_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                                   
    b6_reset_goal TEXT,                    -- Specific, measurable, 1-3 day timeline                                                                                                                                 
    b6_reset_goal_timeline_days INTEGER,                                                                                                                                                                             
    b7_documentation_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                                
                                                                                                                                                                                                                     
    -- Monitoring                                                                                                                                                                                                    
    monitoring_start_date DATE,                                                                                                                                                                                      
    monitoring_end_date DATE,                                                                                                                                                                                        
    monitoring_method TEXT,                -- 'checklist', 'verbal_check', 'written_log'                                                                                                                             
    daily_success_rates JSONB,             -- {"2024-01-15": 80, "2024-01-16": 90, ...}                                                                                                                              
    final_success_rate DECIMAL(5,2),                                                                                                                                                                                 
                                                                                                                                                                                                                     
    -- Outcome                                                                                                                                                                                                       
    status TEXT DEFAULT 'in_progress',     -- 'in_progress', 'completed_success',                                                                                                                                    
                                           -- 'completed_escalated', 'cancelled'                                                                                                                                     
    escalated_to_c BOOLEAN DEFAULT FALSE,                                                                                                                                                                            
    escalation_reason TEXT,                                                                                                                                                                                          
                                                                                                                                                                                                                     
    -- Related Level A (if escalated from A)                                                                                                                                                                         
    escalated_from_level_a_id UUID REFERENCES level_a_interventions(id),                                                                                                                                             
                                                                                                                                                                                                                     
    -- Metadata                                                                                                                                                                                                      
    conference_timestamp TIMESTAMPTZ,                                                                                                                                                                                
    created_at TIMESTAMPTZ DEFAULT NOW(),                                                                                                                                                                            
    updated_at TIMESTAMPTZ DEFAULT NOW()                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- 4. LEVEL C CASES (Case Management, 2-4 weeks)                                                                                                                                                                   
  CREATE TABLE level_c_cases (                                                                                                                                                                                       
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                                   
    student_id UUID NOT NULL REFERENCES students(id),                                                                                                                                                                
    case_manager_id UUID REFERENCES auth.users(id),                                                                                                                                                                  
    case_manager_name TEXT,                                                                                                                                                                                          
                                                                                                                                                                                                                     
    -- Case Classification                                                                                                                                                                                           
    trigger_type TEXT NOT NULL,            -- 'safety_incident', 'no_improvement_2_level_b',                                                                                                                         
                                           -- 'chronic_pattern', 'post_oss_reentry'                                                                                                                                  
    domain_focus_id INTEGER REFERENCES behavioral_domains(id),                                                                                                                                                       
                                                                                                                                                                                                                     
    -- Context Packet (Step 2)                                                                                                                                                                                       
    incident_summary TEXT,                                                                                                                                                                                           
    pattern_review TEXT,                                                                                                                                                                                             
    environmental_factors JSONB,           -- Array of factors                                                                                                                                                       
    prior_interventions_summary TEXT,                                                                                                                                                                                
                                                                                                                                                                                                                     
    -- Admin Response (Step 3)                                                                                                                                                                                       
    admin_response_type TEXT,              -- 'detention', 'iss', 'oss', 'behavior_contract', 'other'                                                                                                                
    admin_response_details TEXT,                                                                                                                                                                                     
    consequence_start_date DATE,                                                                                                                                                                                     
    consequence_end_date DATE,                                                                                                                                                                                       
                                                                                                                                                                                                                     
    -- Student Support Plan (One-page)                                                                                                                                                                               
    support_plan_goal TEXT,                -- Single measurable goal                                                                                                                                                 
    support_plan_domain TEXT,              -- Single domain focus                                                                                                                                                    
    support_plan_strategies JSONB,         -- Array of strategies                                                                                                                                                    
    adult_mentor_id UUID REFERENCES auth.users(id),                                                                                                                                                                  
    adult_mentor_name TEXT,                                                                                                                                                                                          
                                                                                                                                                                                                                     
    -- Repair Actions                                                                                                                                                                                                
    repair_actions JSONB,                  -- Array of repair actions with status                                                                                                                                    
                                                                                                                                                                                                                     
    -- Re-entry Planning (Step 4)                                                                                                                                                                                    
    reentry_date DATE,                                                                                                                                                                                               
    reentry_type TEXT,                     -- 'standard', 'restricted'                                                                                                                                               
    reentry_restrictions JSONB,            -- If restricted: supervised transitions, etc.                                                                                                                            
    reentry_checklist JSONB,               -- 4-point readiness checklist                                                                                                                                            
                                                                                                                                                                                                                     
    -- Monitoring (Step 5)                                                                                                                                                                                           
    monitoring_duration_days INTEGER,      -- 3, 5, or 10 days based on consequence                                                                                                                                  
    monitoring_schedule JSONB,             -- Check-in/out schedule                                                                                                                                                  
    review_dates JSONB,                    -- Scheduled review dates                                                                                                                                                 
    daily_check_ins JSONB,                 -- Daily check-in logs                                                                                                                                                    
                                                                                                                                                                                                                     
    -- Closure                                                                                                                                                                                                       
    closure_criteria TEXT,                                                                                                                                                                                           
    closure_date DATE,                                                                                                                                                                                               
    outcome_status TEXT,                   -- 'closed_success', 'closed_continued_support',                                                                                                                          
                                           -- 'closed_escalated', 'active'                                                                                                                                           
    outcome_notes TEXT,                                                                                                                                                                                              
                                                                                                                                                                                                                     
    -- Related Level B (if escalated from B)                                                                                                                                                                         
    escalated_from_level_b_ids UUID[],     -- Can be multiple Level B attempts                                                                                                                                       
                                                                                                                                                                                                                     
    -- Threshold tracking (if SIS-triggered)                                                                                                                                                                         
    sis_demerit_points_at_creation INTEGER,                                                                                                                                                                          
                                                                                                                                                                                                                     
    -- Status                                                                                                                                                                                                        
    status TEXT DEFAULT 'active',          -- 'active', 'pending_reentry', 'monitoring', 'closed'                                                                                                                    
                                                                                                                                                                                                                     
    -- Metadata                                                                                                                                                                                                      
    created_at TIMESTAMPTZ DEFAULT NOW(),                                                                                                                                                                            
    updated_at TIMESTAMPTZ DEFAULT NOW()                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- 5. RE-ENTRY PROTOCOLS (Tracks re-entry for all levels)                                                                                                                                                          
  CREATE TABLE reentry_protocols (                                                                                                                                                                                   
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                                   
    student_id UUID NOT NULL REFERENCES students(id),                                                                                                                                                                
                                                                                                                                                                                                                     
    -- Source Reference                                                                                                                                                                                              
    source_type TEXT NOT NULL,             -- 'level_b', 'detention', 'iss', 'oss'                                                                                                                                   
    level_b_id UUID REFERENCES level_b_interventions(id),                                                                                                                                                            
    level_c_id UUID REFERENCES level_c_cases(id),                                                                                                                                                                    
                                                                                                                                                                                                                     
    -- Re-entry Configuration                                                                                                                                                                                        
    reentry_date DATE NOT NULL,                                                                                                                                                                                      
    reentry_time TIME,                                                                                                                                                                                               
    receiving_teacher_id UUID,                                                                                                                                                                                       
    receiving_teacher_name TEXT,                                                                                                                                                                                     
                                                                                                                                                                                                                     
    -- Readiness Checklist                                                                                                                                                                                           
    readiness_checklist JSONB,             -- 4-point checklist with completion status                                                                                                                               
    readiness_verified_by UUID,                                                                                                                                                                                      
    readiness_verified_at TIMESTAMPTZ,                                                                                                                                                                               
                                                                                                                                                                                                                     
    -- First Interaction Script                                                                                                                                                                                      
    teacher_script TEXT,                   -- e.g., "Welcome back. Your reset goal is [X]..."                                                                                                                        
    reset_goal_from_intervention TEXT,                                                                                                                                                                               
    first_behavioral_rep_completed BOOLEAN DEFAULT FALSE,                                                                                                                                                            
                                                                                                                                                                                                                     
    -- Monitoring Period                                                                                                                                                                                             
    monitoring_start_date DATE,                                                                                                                                                                                      
    monitoring_end_date DATE,                                                                                                                                                                                        
    monitoring_type TEXT,                  -- '3_day', '5_day', '10_day'                                                                                                                                             
    monitoring_method TEXT,                -- 'checklist', 'check_in_out', 'intensive'                                                                                                                               
                                                                                                                                                                                                                     
    -- Daily Logs                                                                                                                                                                                                    
    daily_logs JSONB,                      -- Array of daily log entries                                                                                                                                             
                                                                                                                                                                                                                     
    -- Outcome                                                                                                                                                                                                       
    outcome TEXT,                          -- 'success', 'partial', 'escalated'                                                                                                                                      
    outcome_notes TEXT,                                                                                                                                                                                              
    completed_at TIMESTAMPTZ,                                                                                                                                                                                        
                                                                                                                                                                                                                     
    -- Metadata                                                                                                                                                                                                      
    created_at TIMESTAMPTZ DEFAULT NOW(),                                                                                                                                                                            
    updated_at TIMESTAMPTZ DEFAULT NOW()                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- 6. INTERVENTION THRESHOLDS (Configurable)                                                                                                                                                                       
  CREATE TABLE student_intervention_thresholds (                                                                                                                                                                     
    id SERIAL PRIMARY KEY,                                                                                                                                                                                           
    threshold_name TEXT NOT NULL UNIQUE,                                                                                                                                                                             
    description TEXT,                                                                                                                                                                                                
                                                                                                                                                                                                                     
    -- Threshold Configuration                                                                                                                                                                                       
    demerit_points INTEGER,                -- SIS demerit threshold                                                                                                                                                  
    intervention_level TEXT,               -- 'level_b', 'level_c_lite', 'level_c', 'level_c_reentry'                                                                                                                
    intervention_duration_days INTEGER,                                                                                                                                                                              
    additional_supports JSONB,             -- Additional required supports                                                                                                                                           
                                                                                                                                                                                                                     
    is_active BOOLEAN DEFAULT TRUE,                                                                                                                                                                                  
    created_at TIMESTAMPTZ DEFAULT NOW()                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- Insert default thresholds                                                                                                                                                                                       
  INSERT INTO student_intervention_thresholds                                                                                                                                                                        
    (threshold_name, description, demerit_points, intervention_level, intervention_duration_days, additional_supports)                                                                                               
  VALUES                                                                                                                                                                                                             
    ('10_point_threshold', '3-day Level B + daily checkmarks', 10, 'level_b', 3, '{"daily_checkmarks": true}'),                                                                                                      
    ('20_point_threshold', '2-week Level C-lite with check-in/out + 2 supports', 20, 'level_c_lite', 14, '{"check_in_out": true, "additional_supports": 2}'),                                                        
    ('30_point_threshold', 'Formal Level C with Student Support Plan', 30, 'level_c', 28, '{"support_plan_required": true}'),                                                                                        
    ('35_point_threshold', 'Mandatory Level C re-entry + 10-day monitoring', 35, 'level_c_reentry', 10, '{"mandatory_reentry": true, "intensive_monitoring": true}'),                                                
    ('40_point_threshold', 'Administrative decision with intensive supports', 40, 'admin_decision', 0, '{"admin_decision_required": true, "intensive_supports": true}');                                             
                                                                                                                                                                                                                     
  -- 7. INTERVENTION ANALYTICS (Daily snapshots)                                                                                                                                                                     
  CREATE TABLE intervention_analytics (                                                                                                                                                                              
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                                   
    snapshot_date DATE NOT NULL,                                                                                                                                                                                     
    snapshot_type TEXT DEFAULT 'daily',    -- 'daily', 'weekly', 'monthly'                                                                                                                                           
                                                                                                                                                                                                                     
    -- Level Distribution                                                                                                                                                                                            
    level_a_count INTEGER DEFAULT 0,                                                                                                                                                                                 
    level_b_count INTEGER DEFAULT 0,                                                                                                                                                                                 
    level_c_count INTEGER DEFAULT 0,                                                                                                                                                                                 
                                                                                                                                                                                                                     
    -- Repeat Rates by Domain                                                                                                                                                                                        
    repeat_rate_prayer_space DECIMAL(5,2),                                                                                                                                                                           
    repeat_rate_hallways DECIMAL(5,2),                                                                                                                                                                               
    repeat_rate_lunch_recess DECIMAL(5,2),                                                                                                                                                                           
    repeat_rate_respect DECIMAL(5,2),                                                                                                                                                                                
    repeat_rate_overall DECIMAL(5,2),                                                                                                                                                                                
                                                                                                                                                                                                                     
    -- Escalation Metrics                                                                                                                                                                                            
    a_to_b_escalation_rate DECIMAL(5,2),                                                                                                                                                                             
    b_to_c_escalation_rate DECIMAL(5,2),                                                                                                                                                                             
                                                                                                                                                                                                                     
    -- Goal Achievement                                                                                                                                                                                              
    level_b_completion_rate DECIMAL(5,2),  -- % with all 7 steps                                                                                                                                                     
    goal_achievement_rate DECIMAL(5,2),    -- % meeting reset goals                                                                                                                                                  
                                                                                                                                                                                                                     
    -- Staff Consistency                                                                                                                                                                                             
    staff_variance_index DECIMAL(5,2),     -- Variance in A/B/C classification                                                                                                                                       
                                                                                                                                                                                                                     
    -- Hot Zones                                                                                                                                                                                                     
    hot_zones JSONB,                       -- {location: count, time: count}                                                                                                                                         
                                                                                                                                                                                                                     
    -- Quality Benchmarks                                                                                                                                                                                            
    quality_score INTEGER,                 -- Composite 1-100                                                                                                                                                        
                                                                                                                                                                                                                     
    created_at TIMESTAMPTZ DEFAULT NOW(),                                                                                                                                                                            
    UNIQUE(snapshot_date, snapshot_type)                                                                                                                                                                             
  );                                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  -- 8. DOMAIN REPAIR MENU (Lookup table)                                                                                                                                                                            
  INSERT INTO behavioral_domains (domain_key, domain_name, description, expectations, repair_menu_immediate, repair_menu_restorative)                                                                                
  VALUES                                                                                                                                                                                                             
    ('prayer_space', 'Prayer Space (Salah & Transitions)',                                                                                                                                                           
     'Sacred space respect, wudu preparation, stillness during prayer, proper entry/exit',                                                                                                                           
     '["Maintain wudu", "Enter prayer space with adab", "Stillness during salah", "Respectful transitions"]',                                                                                                        
     '["Redo entry with adab", "Silent line reset", "Apologize to affected peers", "Reset disrupted space"]',                                                                                                        
     '["Write reflection on salah adab", "Help set up prayer space", "Staff commitment meeting"]'),                                                                                                                  
                                                                                                                                                                                                                     
    ('hallways', 'Hallways & Transitions',                                                                                                                                                                           
     'Right-side flow, quiet voices, hands-to-self, respectful spacing',                                                                                                                                             
     '["Walk on right side", "Use quiet voices", "Keep hands to self", "Maintain respectful spacing"]',                                                                                                              
     '["Redo transition silently", "Flow correction practice", "Apologize for crowding/disruption"]',                                                                                                                
     '["Greeting culture repair", "Reflection note on safety risks", "Hallway monitor duty"]'),                                                                                                                      
                                                                                                                                                                                                                     
    ('lunch_recess', 'Lunch/Recess & Unstructured Time',                                                                                                                                                             
     'Inclusion behaviors, environmental care, conflict resolution',                                                                                                                                                 
     '["Include others", "Care for shared space", "Resolve conflicts peacefully", "Follow adult directions"]',                                                                                                       
     '["Clean area fully", "Specific peer apology", "Supervised inclusion invitation"]',                                                                                                                             
     '["Service repair (table/chair reset)", "Conflict replay writing exercise", "Lunch helper duty"]'),                                                                                                             
                                                                                                                                                                                                                     
    ('respect', 'Respect & Community',                                                                                                                                                                               
     'Appropriate speech, authority relationships, peer interactions, disagreement with dignity',                                                                                                                    
     '["Use appropriate language", "Respect authority", "Treat peers kindly", "Disagree with dignity"]',                                                                                                             
     '["4-step apology format", "Public correction of public disrespect", "Private reflection"]',                                                                                                                    
     '["72-hour respect contract", "Community service", "Restorative circle participation"]');                                                                                                                       
                                                                                                                                                                                                                     
  -- INDEXES                                                                                                                                                                                                         
  CREATE INDEX idx_level_a_student ON level_a_interventions(student_id);                                                                                                                                             
  CREATE INDEX idx_level_a_domain ON level_a_interventions(domain_id);                                                                                                                                               
  CREATE INDEX idx_level_a_staff ON level_a_interventions(staff_id);                                                                                                                                                 
  CREATE INDEX idx_level_a_date ON level_a_interventions(event_timestamp DESC);                                                                                                                                      
  CREATE INDEX idx_level_a_escalated ON level_a_interventions(escalated_to_b) WHERE escalated_to_b = TRUE;                                                                                                           
                                                                                                                                                                                                                     
  CREATE INDEX idx_level_b_student ON level_b_interventions(student_id);                                                                                                                                             
  CREATE INDEX idx_level_b_status ON level_b_interventions(status);                                                                                                                                                  
  CREATE INDEX idx_level_b_monitoring ON level_b_interventions(monitoring_end_date) WHERE status = 'in_progress';                                                                                                    
                                                                                                                                                                                                                     
  CREATE INDEX idx_level_c_student ON level_c_cases(student_id);                                                                                                                                                     
  CREATE INDEX idx_level_c_status ON level_c_cases(status);                                                                                                                                                          
  CREATE INDEX idx_level_c_case_manager ON level_c_cases(case_manager_id);                                                                                                                                           
  CREATE INDEX idx_level_c_reentry ON level_c_cases(reentry_date) WHERE status = 'pending_reentry';                                                                                                                  
                                                                                                                                                                                                                     
  CREATE INDEX idx_reentry_student ON reentry_protocols(student_id);                                                                                                                                                 
  CREATE INDEX idx_reentry_date ON reentry_protocols(reentry_date);                                                                                                                                                  
                                                                                                                                                                                                                     
  -- ROW LEVEL SECURITY                                                                                                                                                                                              
  ALTER TABLE behavioral_domains ENABLE ROW LEVEL SECURITY;                                                                                                                                                          
  ALTER TABLE level_a_interventions ENABLE ROW LEVEL SECURITY;                                                                                                                                                       
  ALTER TABLE level_b_interventions ENABLE ROW LEVEL SECURITY;                                                                                                                                                       
  ALTER TABLE level_c_cases ENABLE ROW LEVEL SECURITY;                                                                                                                                                               
  ALTER TABLE reentry_protocols ENABLE ROW LEVEL SECURITY;                                                                                                                                                           
  ALTER TABLE student_intervention_thresholds ENABLE ROW LEVEL SECURITY;                                                                                                                                             
  ALTER TABLE intervention_analytics ENABLE ROW LEVEL SECURITY;                                                                                                                                                      
                                                                                                                                                                                                                     
  -- Policies (simplified - expand based on RBAC needs)                                                                                                                                                              
  CREATE POLICY "Staff can view all interventions" ON level_a_interventions                                                                                                                                          
    FOR SELECT TO authenticated USING (true);                                                                                                                                                                        
                                                                                                                                                                                                                     
  CREATE POLICY "Staff can create level_a" ON level_a_interventions                                                                                                                                                  
    FOR INSERT TO authenticated WITH CHECK (true);                                                                                                                                                                   
                                                                                                                                                                                                                     
  -- Similar policies needed for other tables...                                                                                                                                                                     
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  3. TECHNICAL IMPLEMENTATION PLAN                                                                                                                                                                                   
                                                                                                                                                                                                                     
âº Phase 1: Foundation (Database + Core Types)                                                                                                                                                                        
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  supabase/migrations/012_abc_intervention_framework.sql                                                                                                                                                             
  apps/portal/src/types/interventions.ts                                                                                                                                                                             
  apps/portal/src/lib/supabase/tables.ts (update)                                                                                                                                                                    
                                                                                                                                                                                                                     
  Key Deliverables:                                                                                                                                                                                                  
  - Database migration with all tables                                                                                                                                                                               
  - TypeScript types for all intervention structures                                                                                                                                                                 
  - Update table constants                                                                                                                                                                                           
                                                                                                                                                                                                                     
  Phase 2: Level A Implementation                                                                                                                                                                                    
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/app/api/interventions/level-a/route.ts         # CRUD                                                                                                                                              
  apps/portal/src/app/dashboard/interventions/level-a/page.tsx   # Staff quick-log UI                                                                                                                                
  apps/portal/src/components/interventions/LevelALogForm.tsx     # Mobile-first form                                                                                                                                 
  apps/portal/src/backend/services/levelAService.ts              # Business logic                                                                                                                                    
                                                                                                                                                                                                                     
  Key Features:                                                                                                                                                                                                      
  - Sub-3-second incident logging workflow                                                                                                                                                                           
  - Domain selection dropdown                                                                                                                                                                                        
  - 8 intervention types                                                                                                                                                                                             
  - Outcome tracking (complied/escalated)                                                                                                                                                                            
  - Offline-capable with sync                                                                                                                                                                                        
                                                                                                                                                                                                                     
  Phase 3: Level B Implementation                                                                                                                                                                                    
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/app/api/interventions/level-b/route.ts                                                                                                                                                             
  apps/portal/src/app/api/interventions/level-b/[id]/route.ts                                                                                                                                                        
  apps/portal/src/app/dashboard/interventions/level-b/page.tsx                                                                                                                                                       
  apps/portal/src/app/dashboard/interventions/level-b/[id]/page.tsx                                                                                                                                                  
  apps/portal/src/components/interventions/LevelBWorkflow.tsx    # 7-step wizard                                                                                                                                     
  apps/portal/src/components/interventions/MonitoringTracker.tsx                                                                                                                                                     
  apps/portal/src/backend/services/levelBService.ts                                                                                                                                                                  
                                                                                                                                                                                                                     
  Key Features:                                                                                                                                                                                                      
  - 7-step protocol wizard (B1-B7)                                                                                                                                                                                   
  - Domain-specific repair menu integration                                                                                                                                                                          
  - Reset goal builder with timeline                                                                                                                                                                                 
  - 3-day monitoring dashboard                                                                                                                                                                                       
  - Success rate calculation (80% threshold)                                                                                                                                                                         
  - Auto-escalation trigger to Level C                                                                                                                                                                               
                                                                                                                                                                                                                     
  Phase 4: Level C Case Management                                                                                                                                                                                   
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/app/api/interventions/level-c/route.ts                                                                                                                                                             
  apps/portal/src/app/api/interventions/level-c/[id]/route.ts                                                                                                                                                        
  apps/portal/src/app/dashboard/interventions/case-management/page.tsx                                                                                                                                               
  apps/portal/src/app/dashboard/interventions/case-management/[id]/page.tsx                                                                                                                                          
  apps/portal/src/components/interventions/ContextPacketBuilder.tsx                                                                                                                                                  
  apps/portal/src/components/interventions/StudentSupportPlan.tsx                                                                                                                                                    
  apps/portal/src/components/interventions/ReentryPlanner.tsx                                                                                                                                                        
  apps/portal/src/backend/services/levelCService.ts                                                                                                                                                                  
  apps/portal/src/backend/services/caseManagerService.ts                                                                                                                                                             
                                                                                                                                                                                                                     
  Key Features:                                                                                                                                                                                                      
  - Case manager assignment workflow                                                                                                                                                                                 
  - Context packet builder (incident summary, patterns, factors)                                                                                                                                                     
  - One-page Student Support Plan generator                                                                                                                                                                          
  - Adult mentor assignment                                                                                                                                                                                          
  - Re-entry date scheduling                                                                                                                                                                                         
  - 10-day intensive monitoring                                                                                                                                                                                      
                                                                                                                                                                                                                     
  Phase 5: Re-entry Protocols                                                                                                                                                                                        
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/app/api/reentry/route.ts                                                                                                                                                                           
  apps/portal/src/app/api/reentry/[id]/route.ts                                                                                                                                                                      
  apps/portal/src/app/dashboard/reentry/page.tsx                                                                                                                                                                     
  apps/portal/src/app/dashboard/reentry/[id]/page.tsx                                                                                                                                                                
  apps/portal/src/components/reentry/ReadinessChecklist.tsx                                                                                                                                                          
  apps/portal/src/components/reentry/TeacherScriptCard.tsx                                                                                                                                                           
  apps/portal/src/components/reentry/DailyLogEntry.tsx                                                                                                                                                               
  apps/portal/src/backend/services/reentryService.ts                                                                                                                                                                 
                                                                                                                                                                                                                     
  Key Features:                                                                                                                                                                                                      
  - 4-point readiness verification                                                                                                                                                                                   
  - Teacher script generator                                                                                                                                                                                         
  - Daily log entry system                                                                                                                                                                                           
  - Outcome tracking                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  Phase 6: Decision Tree & Automation                                                                                                                                                                                
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/backend/services/decisionTreeEngine.ts                                                                                                                                                             
  apps/portal/src/backend/services/escalationService.ts                                                                                                                                                              
  apps/portal/src/app/api/cron/intervention-monitor/route.ts                                                                                                                                                         
                                                                                                                                                                                                                     
  Key Logic:                                                                                                                                                                                                         
  // Decision Tree Implementation                                                                                                                                                                                    
  function determineInterventionLevel(incident: Incident): 'A' | 'B' | 'C' {                                                                                                                                         
    // Step 1: Safety/Major Harm check                                                                                                                                                                               
    if (incident.is_safety_incident || incident.is_major_harm) {                                                                                                                                                     
      return 'C'; // + Admin consequence                                                                                                                                                                             
    }                                                                                                                                                                                                                
                                                                                                                                                                                                                     
    // Step 2: Pattern/Impact Assessment                                                                                                                                                                             
    const triggers = [                                                                                                                                                                                               
      incident.demerit_assigned,                                                                                                                                                                                     
      incident.ignored_prompts >= 2,                                                                                                                                                                                 
      await isThirdIn10Days(incident.student_id, incident.domain_id),                                                                                                                                                
      incident.affected_peers,                                                                                                                                                                                       
      incident.disrupted_shared_space,                                                                                                                                                                               
      incident.is_safety_risk                                                                                                                                                                                        
    ];                                                                                                                                                                                                               
                                                                                                                                                                                                                     
    if (triggers.some(t => t)) {                                                                                                                                                                                     
      // Check if 2 Level B cycles already attempted                                                                                                                                                                 
      const levelBAttempts = await getLevelBAttempts(incident.student_id, incident.domain_id);                                                                                                                       
      if (levelBAttempts >= 2) {                                                                                                                                                                                     
        return 'C';                                                                                                                                                                                                  
      }                                                                                                                                                                                                              
      return 'B';                                                                                                                                                                                                    
    }                                                                                                                                                                                                                
                                                                                                                                                                                                                     
    return 'A';                                                                                                                                                                                                      
  }                                                                                                                                                                                                                  
                                                                                                                                                                                                                     
  Phase 7: Analytics & Reporting                                                                                                                                                                                     
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/app/api/analytics/intervention-metrics/route.ts                                                                                                                                                    
  apps/portal/src/app/dashboard/analytics/interventions/page.tsx                                                                                                                                                     
  apps/portal/src/backend/services/interventionAnalyticsCalculator.ts                                                                                                                                                
  apps/portal/src/components/analytics/InterventionDashboard.tsx                                                                                                                                                     
  apps/portal/src/components/analytics/HotZoneMap.tsx                                                                                                                                                                
  apps/portal/src/components/analytics/StaffConsistencyChart.tsx                                                                                                                                                     
                                                                                                                                                                                                                     
  Key Metrics:                                                                                                                                                                                                       
  - Repeat incident rate by domain                                                                                                                                                                                   
  - A/B/C distribution (healthy = many A, some B, few C)                                                                                                                                                             
  - Level B completion rate (target: 80%+)                                                                                                                                                                           
  - Goal achievement rate (target: 75%+)                                                                                                                                                                             
  - Staff variance index (target: <20%)                                                                                                                                                                              
  - Hot zone visualization                                                                                                                                                                                           
                                                                                                                                                                                                                     
  Phase 8: Staff Training & Calibration                                                                                                                                                                              
                                                                                                                                                                                                                     
  Files to Create:                                                                                                                                                                                                   
  apps/portal/src/app/dashboard/calibration/page.tsx                                                                                                                                                                 
  apps/portal/src/app/dashboard/training/page.tsx                                                                                                                                                                    
  apps/portal/src/components/calibration/WeeklyHuddle.tsx                                                                                                                                                            
  apps/portal/src/components/calibration/CaseReview.tsx                                                                                                                                                              
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  4. MIGRATION STRATEGY FOR EXISTING DATA                                                                                                                                                                            
                                                                                                                                                                                                                     
  Data That Can Be Migrated                                                                                                                                                                                          
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                            
  â”‚       Existing Data        â”‚           Migration Target            â”‚            Approach            â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ student_behaviour_insights â”‚ Link to intervention triggers         â”‚ Add foreign keys, don't delete â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ student_behaviour_patterns â”‚ Pre-populate Level B escalation flags â”‚ Map patterns to triggers       â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ merit_log                  â”‚ Reference for positive patterns       â”‚ Read-only integration          â”‚                                                                                                            
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                            
  â”‚ staff records              â”‚ Case manager candidates               â”‚ Add is_case_manager flag       â”‚                                                                                                            
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                            
  Migration Steps                                                                                                                                                                                                    
                                                                                                                                                                                                                     
  1. Pre-Migration Audit                                                                                                                                                                                             
    - Export current student_behaviour_insights                                                                                                                                                                      
    - Document existing pattern detection rules                                                                                                                                                                      
  2. Schema Migration                                                                                                                                                                                                
    - Run migration 012 (new tables only, no data modification)                                                                                                                                                      
    - Add new columns to profiles for case manager role                                                                                                                                                              
  3. Data Seeding                                                                                                                                                                                                    
    - Populate behavioral_domains with 4 domains                                                                                                                                                                     
    - Populate student_intervention_thresholds with defaults                                                                                                                                                         
    - No historical intervention data to migrate (new system)                                                                                                                                                        
  4. Integration Points                                                                                                                                                                                              
    - Update behaviourAnalyzer.ts to emit escalation events                                                                                                                                                          
    - Add hooks to trigger Level B when patterns detected                                                                                                                                                            
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  5. TESTING FRAMEWORK FOR BEHAVIORAL WORKFLOW ACCURACY                                                                                                                                                              
                                                                                                                                                                                                                     
  Unit Tests (Vitest)                                                                                                                                                                                                
                                                                                                                                                                                                                     
  // tests/unit/interventions/decisionTree.test.ts                                                                                                                                                                   
  describe('Decision Tree Engine', () => {                                                                                                                                                                           
    it('returns Level C for safety incidents', async () => {                                                                                                                                                         
      const incident = { is_safety_incident: true };                                                                                                                                                                 
      expect(await determineInterventionLevel(incident)).toBe('C');                                                                                                                                                  
    });                                                                                                                                                                                                              
                                                                                                                                                                                                                     
    it('returns Level B on 3rd incident in 10 days', async () => {                                                                                                                                                   
      // Setup: Create 2 prior incidents for student                                                                                                                                                                 
      // Assert: 3rd incident returns 'B'                                                                                                                                                                            
    });                                                                                                                                                                                                              
                                                                                                                                                                                                                     
    it('returns Level A when no escalation triggers', async () => {                                                                                                                                                  
      const incident = {                                                                                                                                                                                             
        demerit_assigned: false,                                                                                                                                                                                     
        ignored_prompts: 0,                                                                                                                                                                                          
        affected_peers: false                                                                                                                                                                                        
      };                                                                                                                                                                                                             
      expect(await determineInterventionLevel(incident)).toBe('A');                                                                                                                                                  
    });                                                                                                                                                                                                              
                                                                                                                                                                                                                     
    it('escalates to C after 2 failed Level B cycles', async () => {                                                                                                                                                 
      // Setup: Create 2 completed Level B with escalation                                                                                                                                                           
      // Assert: New incident returns 'C'                                                                                                                                                                            
    });                                                                                                                                                                                                              
  });                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  Integration Tests (Playwright)                                                                                                                                                                                     
                                                                                                                                                                                                                     
  // tests/e2e/interventions/level-b-workflow.spec.ts                                                                                                                                                                
  test('Complete Level B 7-step workflow', async ({ page }) => {                                                                                                                                                     
    // Login as teacher                                                                                                                                                                                              
    await page.goto('/dashboard/interventions/level-b/new');                                                                                                                                                         
                                                                                                                                                                                                                     
    // Step 1: Regulate                                                                                                                                                                                              
    await page.fill('[data-testid="regulate-notes"]', 'Student took deep breaths');                                                                                                                                  
    await page.click('[data-testid="step-1-complete"]');                                                                                                                                                             
                                                                                                                                                                                                                     
    // ... Steps 2-6                                                                                                                                                                                                 
                                                                                                                                                                                                                     
    // Step 7: Documentation                                                                                                                                                                                         
    await page.click('[data-testid="submit-level-b"]');                                                                                                                                                              
                                                                                                                                                                                                                     
    // Verify monitoring period started                                                                                                                                                                              
    await expect(page.locator('[data-testid="monitoring-status"]')).toContainText('Active');                                                                                                                         
  });                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  Workflow Accuracy Tests                                                                                                                                                                                            
                                                                                                                                                                                                                     
  // tests/workflows/escalation-accuracy.test.ts                                                                                                                                                                     
  describe('Escalation Accuracy', () => {                                                                                                                                                                            
    it('escalates appropriately based on real scenarios', async () => {                                                                                                                                              
      const scenarios = [                                                                                                                                                                                            
        {                                                                                                                                                                                                            
          name: 'Student ignores 2 prompts',                                                                                                                                                                         
          input: { ignored_prompts: 2 },                                                                                                                                                                             
          expected: 'B'                                                                                                                                                                                              
        },                                                                                                                                                                                                           
        {                                                                                                                                                                                                            
          name: 'First minor hallway issue',                                                                                                                                                                         
          input: { domain: 'hallways', ignored_prompts: 0 },                                                                                                                                                         
          expected: 'A'                                                                                                                                                                                              
        },                                                                                                                                                                                                           
        // Add 20+ real-world scenarios from DAAIS                                                                                                                                                                   
      ];                                                                                                                                                                                                             
                                                                                                                                                                                                                     
      for (const scenario of scenarios) {                                                                                                                                                                            
        const result = await determineInterventionLevel(scenario.input);                                                                                                                                             
        expect(result, scenario.name).toBe(scenario.expected);                                                                                                                                                       
      }                                                                                                                                                                                                              
    });                                                                                                                                                                                                              
  });                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  Benchmark Tests                                                                                                                                                                                                    
                                                                                                                                                                                                                     
  // tests/benchmarks/logging-performance.test.ts                                                                                                                                                                    
  test('Level A logging completes in under 3 seconds', async () => {                                                                                                                                                 
    const start = performance.now();                                                                                                                                                                                 
    await createLevelAIntervention(sampleData);                                                                                                                                                                      
    const duration = performance.now() - start;                                                                                                                                                                      
                                                                                                                                                                                                                     
    expect(duration).toBeLessThan(3000);                                                                                                                                                                             
  });                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  6. FILE STRUCTURE OVERVIEW                                                                                                                                                                                         
                                                                                                                                                                                                                     
  apps/portal/src/                                                                                                                                                                                                   
  â”œâ”€â”€ app/                                                                                                                                                                                                           
  â”‚   â”œâ”€â”€ api/                                                                                                                                                                                                       
  â”‚   â”‚   â””â”€â”€ interventions/                                                                                                                                                                                         
  â”‚   â”‚       â”œâ”€â”€ level-a/                                                                                                                                                                                           
  â”‚   â”‚       â”‚   â””â”€â”€ route.ts                                                                                                                                                                                       
  â”‚   â”‚       â”œâ”€â”€ level-b/                                                                                                                                                                                           
  â”‚   â”‚       â”‚   â”œâ”€â”€ route.ts                                                                                                                                                                                       
  â”‚   â”‚       â”‚   â””â”€â”€ [id]/route.ts                                                                                                                                                                                  
  â”‚   â”‚       â”œâ”€â”€ level-c/                                                                                                                                                                                           
  â”‚   â”‚       â”‚   â”œâ”€â”€ route.ts                                                                                                                                                                                       
  â”‚   â”‚       â”‚   â””â”€â”€ [id]/route.ts                                                                                                                                                                                  
  â”‚   â”‚       â”œâ”€â”€ reentry/                                                                                                                                                                                           
  â”‚   â”‚       â”‚   â”œâ”€â”€ route.ts                                                                                                                                                                                       
  â”‚   â”‚       â”‚   â””â”€â”€ [id]/route.ts                                                                                                                                                                                  
  â”‚   â”‚       â””â”€â”€ analytics/                                                                                                                                                                                         
  â”‚   â”‚           â””â”€â”€ route.ts                                                                                                                                                                                       
  â”‚   â””â”€â”€ dashboard/                                                                                                                                                                                                 
  â”‚       â””â”€â”€ interventions/                                                                                                                                                                                         
  â”‚           â”œâ”€â”€ page.tsx                # Overview dashboard                                                                                                                                                       
  â”‚           â”œâ”€â”€ level-a/                                                                                                                                                                                           
  â”‚           â”‚   â””â”€â”€ page.tsx            # Quick log interface                                                                                                                                                      
  â”‚           â”œâ”€â”€ level-b/                                                                                                                                                                                           
  â”‚           â”‚   â”œâ”€â”€ page.tsx            # Active Level B list                                                                                                                                                      
  â”‚           â”‚   â””â”€â”€ [id]/page.tsx       # 7-step workflow                                                                                                                                                          
  â”‚           â”œâ”€â”€ case-management/                                                                                                                                                                                   
  â”‚           â”‚   â”œâ”€â”€ page.tsx            # Case manager dashboard                                                                                                                                                   
  â”‚           â”‚   â””â”€â”€ [id]/page.tsx       # Individual case view                                                                                                                                                     
  â”‚           â”œâ”€â”€ reentry/                                                                                                                                                                                           
  â”‚           â”‚   â”œâ”€â”€ page.tsx            # Pending re-entries                                                                                                                                                       
  â”‚           â”‚   â””â”€â”€ [id]/page.tsx       # Re-entry checklist                                                                                                                                                       
  â”‚           â””â”€â”€ analytics/                                                                                                                                                                                         
  â”‚               â””â”€â”€ page.tsx            # Intervention metrics                                                                                                                                                     
  â”œâ”€â”€ backend/                                                                                                                                                                                                       
  â”‚   â””â”€â”€ services/                                                                                                                                                                                                  
  â”‚       â”œâ”€â”€ levelAService.ts                                                                                                                                                                                       
  â”‚       â”œâ”€â”€ levelBService.ts                                                                                                                                                                                       
  â”‚       â”œâ”€â”€ levelCService.ts                                                                                                                                                                                       
  â”‚       â”œâ”€â”€ reentryService.ts                                                                                                                                                                                      
  â”‚       â”œâ”€â”€ decisionTreeEngine.ts                                                                                                                                                                                  
  â”‚       â”œâ”€â”€ escalationService.ts                                                                                                                                                                                   
  â”‚       â””â”€â”€ interventionAnalyticsCalculator.ts                                                                                                                                                                     
  â”œâ”€â”€ components/                                                                                                                                                                                                    
  â”‚   â””â”€â”€ interventions/                                                                                                                                                                                             
  â”‚       â”œâ”€â”€ LevelALogForm.tsx                                                                                                                                                                                      
  â”‚       â”œâ”€â”€ LevelBWorkflow.tsx                                                                                                                                                                                     
  â”‚       â”œâ”€â”€ MonitoringTracker.tsx                                                                                                                                                                                  
  â”‚       â”œâ”€â”€ ContextPacketBuilder.tsx                                                                                                                                                                               
  â”‚       â”œâ”€â”€ StudentSupportPlan.tsx                                                                                                                                                                                 
  â”‚       â”œâ”€â”€ ReentryPlanner.tsx                                                                                                                                                                                     
  â”‚       â”œâ”€â”€ ReadinessChecklist.tsx                                                                                                                                                                                 
  â”‚       â”œâ”€â”€ TeacherScriptCard.tsx                                                                                                                                                                                  
  â”‚       â””â”€â”€ DomainSelector.tsx                                                                                                                                                                                     
  â””â”€â”€ types/                                                                                                                                                                                                         
      â””â”€â”€ interventions.ts                                                                                                                                                                                           
                                                                                                                                                                                                                     
  supabase/migrations/                                                                                                                                                                                               
  â””â”€â”€ 012_abc_intervention_framework.sql                                                                                                                                                                             
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
  7. ROLE UPDATES REQUIRED                                                                                                                                                                                           
                                                                                                                                                                                                                     
  Add to permissions.ts:                                                                                                                                                                                             
                                                                                                                                                                                                                     
  export const PERMISSIONS = {                                                                                                                                                                                       
    // ... existing                                                                                                                                                                                                  
    INTERVENTIONS_LOG_A: 'interventions.log_a',                                                                                                                                                                      
    INTERVENTIONS_CONDUCT_B: 'interventions.conduct_b',                                                                                                                                                              
    INTERVENTIONS_MANAGE_C: 'interventions.manage_c',                                                                                                                                                                
    INTERVENTIONS_VIEW_ALL: 'interventions.view_all',                                                                                                                                                                
    CASE_MANAGEMENT: 'case.management',                                                                                                                                                                              
  } as const;                                                                                                                                                                                                        
                                                                                                                                                                                                                     
  export const ROLES = {                                                                                                                                                                                             
    // ... existing                                                                                                                                                                                                  
    CASE_MANAGER: 'case_manager',  // Tarbiyah Director + Counselors                                                                                                                                                 
  } as const;                                                                                                                                                                                                        
                                                                                                                                                                                                                     
  Role Permissions Matrix:                                                                                                                                                                                           
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                                                              
  â”‚     Role     â”‚ Level A â”‚ Level B â”‚ Level C â”‚ Re-entry â”‚ Analytics â”‚                                                                                                                                              
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                              
  â”‚ Teacher      â”‚ Log     â”‚ Conduct â”‚ View    â”‚ Execute  â”‚ View own  â”‚                                                                                                                                              
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                              
  â”‚ Case Manager â”‚ Log     â”‚ Conduct â”‚ Manage  â”‚ Plan     â”‚ View all  â”‚                                                                                                                                              
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                                                              
  â”‚ Admin        â”‚ Full    â”‚ Full    â”‚ Full    â”‚ Full     â”‚ Full      â”‚                                                                                                                                              
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                                                              
  ---                                                                                                                                                                                                                
                                                                                                                                                                                                                     
âº SUMMARY                                                                                                                                                                                                            
                                                                                                                                                                                                                     
  What Exists (Leverage)                                                                                                                                                                                             
                                                                                                                                                                                                                     
  - Solid Next.js + Supabase architecture                                                                                                                                                                            
  - RBAC system ready for case manager role                                                                                                                                                                          
  - Behavior pattern detection (can trigger escalations)                                                                                                                                                             
  - Email/notification infrastructure                                                                                                                                                                                
  - Analytics snapshot pattern                                                                                                                                                                                       
                                                                                                                                                                                                                     
  What's Missing (Build)                                                                                                                                                                                             
                                                                                                                                                                                                                     
  - All A/B/C intervention tables (provided above)                                                                                                                                                                   
  - Four behavioral domains with repair menus                                                                                                                                                                        
  - Level A quick-logging UI (mobile-first)                                                                                                                                                                          
  - Level B 7-step workflow with monitoring                                                                                                                                                                          
  - Level C case management with support plans                                                                                                                                                                       
  - Re-entry protocols with checklists                                                                                                                                                                               
  - Decision tree engine for automatic escalation                                                                                                                                                                    
  - Intervention analytics dashboard                                                                                                                                                                                 
                                                                                                                                                                                                                     
  Next Steps                                                                                                                                                                                                         
                                                                                                                                                                                                                     
  1. Create migration file 012_abc_intervention_framework.sql                                                                                                                                                        
  2. Add TypeScript types for interventions                                                                                                                                                                          
  3. Build Level A logging (fastest win for staff adoption)                                                                                                                                                          
  4. Implement Level B workflow                                                                                                                                                                                      
  5. Add Level C case management                                                                                                                                                                                     
  6. Wire up analytics and reporting                                                                                                                                                                                 
                                                                                                                                                                                                                     
  The existing codebase provides excellent patterns to follow. The merit_log pattern maps well to level_a_interventions, and the intervention_logs table (staff-focused) provides a good model for the new           
  student-focused intervention tables.